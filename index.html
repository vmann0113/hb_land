<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>한빔한복 랜딩</title>
  <!-- 캐시 방지: 숫자만 바꿔도 즉시 반영 -->
  <link rel="stylesheet" href="style.css?v=20260112-200" />
</head>
<body>

<main class="landing">

  <!-- 01 히어로 -->
  <section class="block">
    <img src="assets/01_hero.png" alt="히어로">
  </section>

  <!-- 02 상담신청(입력폼) -->
  <section class="block block-overlay" id="formSection">
    <img src="assets/02_form.png" alt="상담신청(입력폼)">
    <form class="overlay-layer" id="leadForm" novalidate>
      <input class="ov ov-name" name="name" placeholder="이름을 입력하세요" required autocomplete="name">
      <input class="ov ov-phone" name="phone" placeholder="연락처를 입력하세요" maxlength="13" inputmode="numeric" required autocomplete="tel">

      <select class="ov ov-branch" name="branch" required>
        <option value="" disabled selected>지점을 선택하세요</option>
        <option>김해점</option><option>마산점</option><option>부산점</option><option>안산점</option>
        <option>양산점</option><option>인천점</option><option>진주점</option><option>창원점</option>
      </select>

      <input class="ov ov-date" name="date" type="date" required>
      <button class="ov ov-submit" type="submit" aria-label="제출하기"></button>
    </form>
  </section>

  <!-- 03 매장소개 (높이 변경/축소) -->
  <section class="block short">
    <img src="assets/03_store_intro.png" alt="매장소개">
  </section>

  <!-- 04 차별성 (신규 / 투명버튼 포함) -->
  <section class="block block-overlay">
    <img src="assets/04_differentiation.png" alt="차별성">
    <div class="overlay-layer">
      <!-- 04 섹션 내 CTA 성격 투명버튼: 폼 섹션으로 이동 -->
      <button class="ov ov-store-cta" type="button" aria-label="상담신청으로 이동"></button>
    </div>
  </section>

  <!-- 05 리뷰 -->
  <section class="block">
    <img src="assets/05_reviews.png" alt="리뷰">
  </section>

  <!-- 06 전국지점 -->
  <section class="block">
    <img src="assets/06_stores.png" alt="전국지점">
  </section>

  <!-- 07 룩북 -->
  <section class="block">
    <img src="assets/07_lookbook.png" alt="룩북">
  </section>

  <!-- 08 지점별 네이버링크(투명버튼) -->
  <section class="block block-overlay">
    <img src="assets/08_naver_links.png" alt="지점별 네이버 예약">
    <div class="overlay-layer" id="naverLinks">
      <a class="ov ov-busan"   data-branch="부산점" href="https://m.booking.naver.com/booking/6/bizes/661812"   target="_blank" rel="noopener noreferrer" aria-label="부산점 네이버 예약"></a>
      <a class="ov ov-incheon" data-branch="인천점" href="https://m.booking.naver.com/booking/13/bizes/1039475" target="_blank" rel="noopener noreferrer" aria-label="인천점 네이버 예약"></a>
      <a class="ov ov-ansan"   data-branch="안산점" href="https://m.booking.naver.com/booking/6/bizes/1500008"  target="_blank" rel="noopener noreferrer" aria-label="안산점 네이버 예약"></a>

      <a class="ov ov-ulsan"   data-branch="울산점" href="https://booking.naver.com/booking/6/bizes/1534767"    target="_blank" rel="noopener noreferrer" aria-label="울산점 네이버 예약"></a>
      <a class="ov ov-masan"   data-branch="마산점" href="https://booking.naver.com/booking/6/bizes/1526541"    target="_blank" rel="noopener noreferrer" aria-label="마산점 네이버 예약"></a>
      <a class="ov ov-jinju"   data-branch="진주점" href="https://m.booking.naver.com/booking/6/bizes/1485854"  target="_blank" rel="noopener noreferrer" aria-label="진주점 네이버 예약"></a>

      <a class="ov ov-changwon" data-branch="창원점" href="https://booking.naver.com/booking/6/bizes/843111"    target="_blank" rel="noopener noreferrer" aria-label="창원점 네이버 예약"></a>
      <a class="ov ov-gimhae"   data-branch="김해점" href="https://booking.naver.com/booking/6/bizes/1402679"   target="_blank" rel="noopener noreferrer" aria-label="김해점 네이버 예약"></a>
      <a class="ov ov-yangsan"  data-branch="양산점" href="https://booking.naver.com/booking/13/bizes/868629"   target="_blank" rel="noopener noreferrer" aria-label="양산점 네이버 예약"></a>
    </div>
  </section>

  <!-- 09 푸터 -->
  <section class="block">
    <img src="assets/09_footer.png" alt="푸터">
  </section>

</main>

<!-- ✅ 하단 고정 CTA: picture로 “둘 중 하나만” 렌더 → 모바일 2개 노출 원천 차단 -->
<div class="fixed-cta">
  <picture class="cta-picture">
    <source media="(max-width: 600px)" srcset="assets/cta_mobile_750.png">
    <img src="assets/cta_1080.png" alt="상담 예약하기">
  </picture>
  <button class="fixed-cta-click" type="button" aria-label="상담 예약하기"></button>
</div>

<div id="toast" aria-live="polite"></div>

<script>
  // ✅ 줄바꿈/공백으로 URL 깨지는 문제 방지: trim() 강제
  const GAS_WEBAPP_URL = "https://script.google.com/macros/s/AKfycbyiPaERPD1ZUBNO7T40wR5Tcy0jU0qtw5SRwBylCHAvRSjafqHOLGkAWGhxKyUgCerM/exec".trim();

  // 토스트
  const toast = document.getElementById('toast');
  let toastTimer = null;
  function showToast(msg){
    toast.textContent = msg;
    toast.classList.add('show');
    clearTimeout(toastTimer);
    toastTimer = setTimeout(()=>toast.classList.remove('show'),2200);
  }

  // 공통: 폼 섹션으로 이동
  function goToForm(){
    document.getElementById('formSection').scrollIntoView({behavior:'smooth', block:'start'});
    setTimeout(()=>document.querySelector('.ov-name')?.focus(), 450);
  }

  // 하단 CTA 클릭 → 폼 섹션
  document.querySelector('.fixed-cta-click')?.addEventListener('click', goToForm);

  // 04 섹션 투명버튼 → 폼 섹션
  document.querySelector('.ov-store-cta')?.addEventListener('click', goToForm);

  // 연락처 자동 하이픈
  const phone = document.querySelector('.ov-phone');
  phone?.addEventListener('input', ()=>{
    let n = phone.value.replace(/[^0-9]/g,'').slice(0,11);
    phone.value =
      n.length < 4 ? n :
      n.length < 8 ? n.slice(0,3)+'-'+n.slice(3) :
      n.slice(0,3)+'-'+n.slice(3,7)+'-'+n.slice(7);
  });

  // 달력 강제 오픈(showPicker)
  const dateInput = document.querySelector('.ov-date');
  function openDatePicker(){
    try{
      if (dateInput && typeof dateInput.showPicker === 'function') dateInput.showPicker();
      else if (dateInput) { dateInput.focus(); dateInput.click(); }
    }catch(e){
      try { dateInput?.focus(); } catch(_) {}
    }
  }
  dateInput?.addEventListener('click', openDatePicker);
  dateInput?.addEventListener('touchstart', (e)=>{
    e.preventDefault();
    openDatePicker();
  }, {passive:false});

  // 네이버 링크 클릭 집계 (data-branch 달린 링크면 자동)
  document.addEventListener('click', (e)=>{
    const a = e.target.closest('a[data-branch]');
    if(!a) return;
    const payload = JSON.stringify({ type:'click', branch:a.dataset.branch, ts:Date.now() });
    if (navigator.sendBeacon) navigator.sendBeacon(GAS_WEBAPP_URL, payload);
    else fetch(GAS_WEBAPP_URL,{ method:'POST', body: payload, keepalive:true }).catch(()=>{});
  });

// 폼 제출
const form = document.getElementById('leadForm');
const submitBtn = document.querySelector('.ov-submit');
let submitting = false;

function getField(name){
  return form?.elements?.namedItem(name) || form?.elements?.[name] || null;
}

function validateForm(){
  const nameEl = getField('name');
  const phoneEl = getField('phone');
  const branchEl = getField('branch');
  const dateEl = getField('date');

  if(!nameEl || !phoneEl || !branchEl || !dateEl) {
    return {ok:false, msg:'폼 구성 오류(필드 누락). 새로고침 후 다시 시도해주세요.'};
  }
  if(!nameEl.value.trim()) return {ok:false, msg:'이름을 입력해주세요.'};
  if(!phoneEl.value.trim()) return {ok:false, msg:'연락처를 입력해주세요.'};
  if(!branchEl.value) return {ok:false, msg:'지점을 선택해주세요.'};
  if(!dateEl.value) return {ok:false, msg:'예식일정을 선택해주세요.'};
  return {ok:true};
}

function sendLead(payload){
  // ✅ 1) 가능하면 sendBeacon (응답 기다릴 필요 없음 / 모바일에서도 안정)
  if (navigator.sendBeacon) {
    const blob = new Blob([payload], { type: 'application/json' });
    const ok = navigator.sendBeacon(GAS_WEBAPP_URL, blob);
    return ok;
  }
  return false;
}

form?.addEventListener('submit', (e)=>{
  e.preventDefault();
  if (submitting) return;

  const v = validateForm();
  if(!v.ok){
    showToast(v.msg);
    return;
  }

  const nameEl = getField('name');
  const phoneEl = getField('phone');
  const branchEl = getField('branch');
  const dateEl = getField('date');

  const payload = JSON.stringify({
    type:'lead',
    name: nameEl.value.trim(),
    phone: phoneEl.value.trim(),
    branch: branchEl.value,
    date: dateEl.value,
    ts: Date.now()
  });

  submitting = true;
  if (submitBtn){
    submitBtn.disabled = true;
    submitBtn.style.pointerEvents = 'none';
  }

  showToast('접수중입니다...');

  // ✅ 응답을 기다리지 않고 “즉시 성공 처리”
  const beaconOk = sendLead(payload);

  // sendBeacon이 실패했을 때만 fetch fallback (그래도 응답은 안 기다림)
  if (!beaconOk) {
    fetch(GAS_WEBAPP_URL, { method:'POST', body: payload, keepalive:true }).catch(()=>{});
  }

  // ✅ 여기서 바로 완료 토스트/리셋
  showToast('접수 완료되었습니다!');
  form.reset();

  submitting = false;
  if (submitBtn){
    submitBtn.disabled = false;
    submitBtn.style.pointerEvents = 'auto';
  }
});


</script>

</body>
</html>




