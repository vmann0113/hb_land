<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>한빔한복 예약</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<div class="page">
  <!-- 통짜 이미지 -->
  <img src="assets/hanbim_all_1080.png" alt="한빔한복 랜딩">

  <!-- CTA 이미지 (1080 기준) -->
  <img src="assets/cta_1080.png" class="cta-image" alt="상담 예약하기">

  <!-- CTA 클릭 영역 -->
  <a href="#formAnchor" class="cta-click" aria-label="상담 예약하기"></a>

  <!-- 폼 앵커 -->
  <div id="formAnchor"></div>

  <!-- ===============================
       지점별 네이버 예약 링크
       =============================== -->
  <a class="branch-link br-busan"   data-branch="부산점" href="https://m.booking.naver.com/booking/6/bizes/661812"   target="_blank"></a>
  <a class="branch-link br-incheon" data-branch="인천점" href="https://m.booking.naver.com/booking/13/bizes/1039475" target="_blank"></a>
  <a class="branch-link br-ansan"   data-branch="안산점" href="https://m.booking.naver.com/booking/6/bizes/1500008"  target="_blank"></a>

  <a class="branch-link br-ulsan"   data-branch="울산점" href="https://booking.naver.com/booking/6/bizes/1534767"    target="_blank"></a>
  <a class="branch-link br-masan"   data-branch="마산점" href="https://booking.naver.com/booking/6/bizes/1526541"    target="_blank"></a>
  <a class="branch-link br-jinju"   data-branch="진주점" href="https://m.booking.naver.com/booking/6/bizes/1485854"  target="_blank"></a>

  <a class="branch-link br-changwon" data-branch="창원점" href="https://booking.naver.com/booking/6/bizes/843111"    target="_blank"></a>
  <a class="branch-link br-gimhae"   data-branch="김해점" href="https://booking.naver.com/booking/6/bizes/1402679"   target="_blank"></a>
  <a class="branch-link br-yangsan"  data-branch="양산점" href="https://booking.naver.com/booking/13/bizes/868629"   target="_blank"></a>

  <!-- ===============================
       상담 폼
       =============================== -->
  <form class="overlay-form" id="leadForm">

    <input class="field f-name" name="name" placeholder="이름을 입력하세요" required>

    <input class="field f-phone" name="phone" placeholder="연락처를 입력하세요"
           maxlength="13" inputmode="numeric" required>

    <select class="field f-branch" name="branch" required>
      <option value="" disabled selected>지점을 선택하세요</option>
      <option>김해점</option>
      <option>마산점</option>
      <option>부산점</option>
      <option>안산점</option>
      <option>양산점</option>
      <option>인천점</option>
      <option>진주점</option>
      <option>창원점</option>
    </select>

    <input class="field f-date" name="date" type="date" required>

    <button class="field f-submit" type="submit"></button>

  </form>
</div>

<div id="toast"></div>

<script>
  const GAS_WEBAPP_URL =
    "https://script.google.com/macros/s/AKfycbzhLiZNO3t-XaZxCxsu0diISjKTUpi7PwNGjGyXgiC0n_Mrzsfv_PiVQJjxkbYBs3xF/exec";

  const toast = document.getElementById('toast');
  function showToast(msg){
    toast.textContent = msg;
    toast.classList.add('show');
    setTimeout(()=>toast.classList.remove('show'),2200);
  }

  /* 연락처 자동 하이픈 */
  const phone = document.querySelector('.f-phone');
  phone.addEventListener('input', ()=>{
    let n = phone.value.replace(/[^0-9]/g,'').slice(0,11);
    phone.value =
      n.length < 4 ? n :
      n.length < 8 ? n.slice(0,3)+'-'+n.slice(3) :
      n.slice(0,3)+'-'+n.slice(3,7)+'-'+n.slice(7);
  });

  /* 네이버 예약 클릭 집계 */
  document.querySelectorAll('.branch-link').forEach(a=>{
    a.addEventListener('click',()=>{
      const payload = JSON.stringify({
        type:'click',
        branch:a.dataset.branch,
        ts:Date.now()
      });
      navigator.sendBeacon(GAS_WEBAPP_URL, payload);
    });
  });

  /* 폼 제출 */
  const form = document.getElementById('leadForm');
  form.addEventListener('submit', async e=>{
    e.preventDefault();

    if(!form.checkValidity()){
      form.reportValidity();
      return;
    }

    const payload = JSON.stringify({
      type:'lead',
      name:form.name.value.trim(),
      phone:form.phone.value.trim(),
      branch:form.branch.value,
      date:form.date.value,
      ts:Date.now()
    });

    try{
      showToast('접수중입니다...');
      await fetch(GAS_WEBAPP_URL,{
        method:'POST',
        body: payload   // ❗ headers 제거 (CORS 해결)
      });
      showToast('예약 접수 완료!');
      form.reset();
    }catch(e){
      showToast('전송 실패. 다시 시도해주세요.');
    }
  });
</script>

</body>
</html>
